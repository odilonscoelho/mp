#!/bin/zsh
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
save () #reformular
{
  sock
  file="$(select.file save)"
  [[ -z $file ]] && msg "Operação cancelada ! PLaylist não Salva!"
  [[ -d $file ]] && msg "Operação cancelada ! PLaylist não Salva! Foi selecionado apenas o diretório"
  t=1;while read line; do; export title[$t]=$line;t=$t+1;done < /tmp/mptitles
  echo "#EXTM3U" >| $file
  i=1
  while read line
  do
    echo "#EXTINF:'" "', $line\n$(< /tmp/mpurls| sed -n ''$i'p')" >> $file &&
    i=$(( $i + 1 ))
  done < /tmp/mptitles
  wq notificatime 10000 "playlist salva em $file"
}
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
select.file () #Argumentos
{
  sock
  [[ -z $1 ]] && \
    file="$(yad --separator="!" --text="Select files....$ _>" --file --multiple)" && \
      [[ -n $file ]] && mp "$file" #url file &&
  [[ -n $1 ]] && yad --text="Select files....$\_>" --file --multiple --save
}
#--------------------------------------------------\---------------------------------------------------------------------------------------------------------------------------------------------------#
play.best ()
{
  sock.ativo && \
    add.url || rm -f $sock && mpv --x11-name="$new_class" $url --input-ipc-server=$sock &
}
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
pause.toggle () #Argumentos
{
  sock
  if [[ $(echo '{ "command": ["get_property", "pause"] }' |socat - $sock |grep 'true') ]];then
    echo '{ "command": ["set_property", "pause", false] }' |socat - $sock
  else
    echo '{ "command": ["set_property", "pause", true] }' |socat - $sock
  fi
}
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
msg () #Argumentos
{
  yad --form --button=yad-ok --borders=5 --mouse --geometry=700x300 --title "Information:" --field=CONTEUDO:TXT "$@"
}
